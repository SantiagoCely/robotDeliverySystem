import { RegexValidator } from "../util/regex-validator";
import { ObjectMaker } from "../util/object-maker";
import { AnnotationTypes } from "../core/validator.static";
import { FormProvider } from '../util/form-provider';
import { ApplicationUtil } from '../util/app-util';
import { getConfigObject } from "../util/config-provider";
export function uniqueValidator(configModel) {
    var setTimeoutFunc = (invalidateControls, controlValues) => {
        let timeOut = setTimeout(() => {
            invalidateControls.forEach(t => {
                let isMatched = controlValues.filter(x => x == t.value)[0];
                if (!isMatched)
                    t.updateValueAndValidity();
            });
            clearTimeout(timeOut);
        }, 200);
    };
    var additionalValidation = (config, fieldName, formGroup, formArray, currentValue) => {
        let indexOf = formArray.controls.indexOf(formGroup);
        let formArrayValue = [];
        if (indexOf != -1) {
            formArray.value.forEach((t, i) => {
                if (indexOf != i)
                    formArrayValue.push(t);
            });
            return config.additionalValidation(currentValue, indexOf, fieldName, formGroup.value, formArrayValue);
        }
        return false;
    };
    return (control) => {
        let config = getConfigObject(configModel, control);
        if (FormProvider.ProcessRule(control, config)) {
            if (RegexValidator.isNotBlank(control.value)) {
                let formArray = ApplicationUtil.getParentFormArray(control);
                let parentFormGroup = control.parent ? control.parent : undefined;
                let invalidateControls = [];
                let controlValues = [];
                if (formArray && parentFormGroup) {
                    let currentValue = control.value;
                    let fieldName = ApplicationUtil.getFormControlName(control);
                    let isMatched = false;
                    for (let formGroup of formArray.controls) {
                        if (formGroup != parentFormGroup) {
                            isMatched = (ApplicationUtil.toLower(formGroup.controls[fieldName].value) == ApplicationUtil.toLower(currentValue) && !(formGroup.controls[fieldName].errors && formGroup.controls[fieldName].errors[AnnotationTypes.unique]));
                            if (formGroup.controls[fieldName].errors && formGroup.controls[fieldName].errors[AnnotationTypes.unique]) {
                                var matchedControl = formArray.controls.filter(t => t.controls[fieldName] != formGroup.controls[fieldName] && ApplicationUtil.toLower(t.controls[fieldName].value) == ApplicationUtil.toLower(formGroup.controls[fieldName].value))[0];
                                if (!matchedControl)
                                    invalidateControls.push(formGroup.controls[fieldName]);
                            }
                            else
                                controlValues.push(formGroup.controls[fieldName].value);
                        }
                        if (isMatched)
                            break;
                    }
                    if (invalidateControls.length > 0)
                        setTimeoutFunc(invalidateControls, controlValues);
                    let validation = false;
                    if (config.additionalValidation) {
                        validation = additionalValidation(config, fieldName, parentFormGroup, formArray, currentValue);
                    }
                    if (isMatched && !validation)
                        return ObjectMaker.toJson(AnnotationTypes.unique, config, [control.value]);
                }
            }
        }
        return ObjectMaker.null();
    };
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidW5pcXVlLnZhbGlkYXRvci5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL3BhY2thZ2VzL3JlYWN0aXZlLWZvcm0tdmFsaWRhdG9ycy9yZWFjdGl2ZS1mb3JtLXZhbGlkYXRvcnMvdW5pcXVlLnZhbGlkYXRvci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFNQSxPQUFPLEVBQUUsY0FBYyxFQUFFLE1BQU0seUJBQXlCLENBQUM7QUFDekQsT0FBTyxFQUFFLFdBQVcsRUFBRSxNQUFNLHNCQUFzQixDQUFDO0FBRW5ELE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSwwQkFBMEIsQ0FBQztBQUMzRCxPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0sdUJBQXVCLENBQUM7QUFDckQsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLGtCQUFrQixDQUFDO0FBQ25ELE9BQU8sRUFBQyxlQUFlLEVBQUMsTUFBTSx5QkFBeUIsQ0FBQztBQUN4RCxNQUFNLFVBQVUsZUFBZSxDQUFDLFdBQXlCO0lBQ3JELElBQUksY0FBYyxHQUFHLENBQUMsa0JBQXFDLEVBQUUsYUFBb0IsRUFBRSxFQUFFO1FBQ3JGLElBQUksT0FBTyxHQUFHLFVBQVUsQ0FBQyxHQUFHLEVBQUU7WUFDNUIsa0JBQWtCLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxFQUFFO2dCQUM3QixJQUFJLFNBQVMsR0FBRyxhQUFhLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQTtnQkFDMUQsSUFBSSxDQUFDLFNBQVM7b0JBQ1osQ0FBQyxDQUFDLHNCQUFzQixFQUFFLENBQUM7WUFDL0IsQ0FBQyxDQUFDLENBQUE7WUFDRixZQUFZLENBQUMsT0FBTyxDQUFDLENBQUM7UUFDeEIsQ0FBQyxFQUFFLEdBQUcsQ0FBQyxDQUFBO0lBQ1QsQ0FBQyxDQUFBO0lBQ0QsSUFBSSxvQkFBb0IsR0FBRyxDQUFDLE1BQW9CLEVBQUUsU0FBaUIsRUFBRSxTQUEwQixFQUFFLFNBQW9CLEVBQUUsWUFBaUIsRUFBRSxFQUFFO1FBQzFJLElBQUksT0FBTyxHQUFHLFNBQVMsQ0FBQyxRQUFRLENBQUMsT0FBTyxDQUFDLFNBQVMsQ0FBQyxDQUFDO1FBQ3BELElBQUksY0FBYyxHQUFHLEVBQUUsQ0FBQztRQUN4QixJQUFJLE9BQU8sSUFBSSxDQUFDLENBQUMsRUFBRTtZQUNqQixTQUFTLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsRUFBRTtnQkFDL0IsSUFBSSxPQUFPLElBQUksQ0FBQztvQkFDZCxjQUFjLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFBO1lBQzFCLENBQUMsQ0FBQyxDQUFBO1lBQ0YsT0FBTyxNQUFNLENBQUMsb0JBQW9CLENBQUMsWUFBWSxFQUFFLE9BQU8sRUFBRSxTQUFTLEVBQUUsU0FBUyxDQUFDLEtBQUssRUFBRSxjQUFjLENBQUMsQ0FBQztTQUN2RztRQUNELE9BQU8sS0FBSyxDQUFDO0lBRWYsQ0FBQyxDQUFBO0lBQ0QsT0FBTyxDQUFDLE9BQXdCLEVBQTBCLEVBQUU7UUFDMUQsSUFBSSxNQUFNLEdBQUcsZUFBZSxDQUFDLFdBQVcsRUFBQyxPQUFPLENBQUMsQ0FBQztRQUNsRCxJQUFJLFlBQVksQ0FBQyxXQUFXLENBQUMsT0FBTyxFQUFFLE1BQU0sQ0FBQyxFQUFFO1lBQzdDLElBQUksY0FBYyxDQUFDLFVBQVUsQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLEVBQUU7Z0JBQzVDLElBQUksU0FBUyxHQUFHLGVBQWUsQ0FBQyxrQkFBa0IsQ0FBQyxPQUFPLENBQUMsQ0FBQztnQkFDNUQsSUFBSSxlQUFlLEdBQUcsT0FBTyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsU0FBUyxDQUFDO2dCQUNsRSxJQUFJLGtCQUFrQixHQUFzQixFQUFFLENBQUM7Z0JBQy9DLElBQUksYUFBYSxHQUFHLEVBQUUsQ0FBQztnQkFDdkIsSUFBSSxTQUFTLElBQUksZUFBZSxFQUFFO29CQUNoQyxJQUFJLFlBQVksR0FBRyxPQUFPLENBQUMsS0FBSyxDQUFDO29CQUNqQyxJQUFJLFNBQVMsR0FBRyxlQUFlLENBQUMsa0JBQWtCLENBQUMsT0FBTyxDQUFDLENBQUM7b0JBQzVELElBQUksU0FBUyxHQUFHLEtBQUssQ0FBQztvQkFDdEIsS0FBSyxJQUFJLFNBQVMsSUFBSSxTQUFTLENBQUMsUUFBUSxFQUFFO3dCQUN4QyxJQUFJLFNBQVMsSUFBSSxlQUFlLEVBQUU7NEJBQ2hDLFNBQVMsR0FBRyxDQUFDLGVBQWUsQ0FBQyxPQUFPLENBQUMsU0FBUyxDQUFDLFFBQVEsQ0FBQyxTQUFTLENBQUMsQ0FBQyxLQUFLLENBQUMsSUFBSSxlQUFlLENBQUMsT0FBTyxDQUFDLFlBQVksQ0FBQyxJQUFJLENBQUMsQ0FBQyxTQUFTLENBQUMsUUFBUSxDQUFDLFNBQVMsQ0FBQyxDQUFDLE1BQU0sSUFBSSxTQUFTLENBQUMsUUFBUSxDQUFDLFNBQVMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxlQUFlLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFBOzRCQUM5TixJQUFJLFNBQVMsQ0FBQyxRQUFRLENBQUMsU0FBUyxDQUFDLENBQUMsTUFBTSxJQUFJLFNBQVMsQ0FBQyxRQUFRLENBQUMsU0FBUyxDQUFDLENBQUMsTUFBTSxDQUFDLGVBQWUsQ0FBQyxNQUFNLENBQUMsRUFBRTtnQ0FDeEcsSUFBSSxjQUFjLEdBQUcsU0FBUyxDQUFDLFFBQVEsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsUUFBUSxDQUFDLFNBQVMsQ0FBQyxJQUFJLFNBQVMsQ0FBQyxRQUFRLENBQUMsU0FBUyxDQUFDLElBQUksZUFBZSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsUUFBUSxDQUFDLFNBQVMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxJQUFJLGVBQWUsQ0FBQyxPQUFPLENBQUMsU0FBUyxDQUFDLFFBQVEsQ0FBQyxTQUFTLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO2dDQUN2TyxJQUFJLENBQUMsY0FBYztvQ0FDakIsa0JBQWtCLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxRQUFRLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQTs2QkFDekQ7O2dDQUVDLGFBQWEsQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLFFBQVEsQ0FBQyxTQUFTLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQzt5QkFDM0Q7d0JBQ0QsSUFBSSxTQUFTOzRCQUNYLE1BQU07cUJBQ1Q7b0JBQ0QsSUFBSSxrQkFBa0IsQ0FBQyxNQUFNLEdBQUcsQ0FBQzt3QkFDL0IsY0FBYyxDQUFDLGtCQUFrQixFQUFFLGFBQWEsQ0FBQyxDQUFDO29CQUVwRCxJQUFJLFVBQVUsR0FBRyxLQUFLLENBQUM7b0JBQ3ZCLElBQUksTUFBTSxDQUFDLG9CQUFvQixFQUFFO3dCQUMvQixVQUFVLEdBQUcsb0JBQW9CLENBQUMsTUFBTSxFQUFFLFNBQVMsRUFBRSxlQUFlLEVBQUUsU0FBUyxFQUFFLFlBQVksQ0FBQyxDQUFDO3FCQUNoRztvQkFDRCxJQUFJLFNBQVMsSUFBSSxDQUFDLFVBQVU7d0JBQzFCLE9BQU8sV0FBVyxDQUFDLE1BQU0sQ0FBQyxlQUFlLENBQUMsTUFBTSxFQUFFLE1BQU0sRUFBRSxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFBO2lCQUM3RTthQUNGO1NBQ0Y7UUFDRCxPQUFPLFdBQVcsQ0FBQyxJQUFJLEVBQUUsQ0FBQztJQUM1QixDQUFDLENBQUE7QUFDSCxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcclxuICBWYWxpZGF0b3JGbixcclxuICBBYnN0cmFjdENvbnRyb2wsXHJcbiAgRm9ybUFycmF5XHJcbn0gZnJvbSBcIkBhbmd1bGFyL2Zvcm1zXCI7XHJcblxyXG5pbXBvcnQgeyBSZWdleFZhbGlkYXRvciB9IGZyb20gXCIuLi91dGlsL3JlZ2V4LXZhbGlkYXRvclwiO1xyXG5pbXBvcnQgeyBPYmplY3RNYWtlciB9IGZyb20gXCIuLi91dGlsL29iamVjdC1tYWtlclwiO1xyXG5pbXBvcnQgeyBVbmlxdWVDb25maWcgfSBmcm9tIFwiLi4vbW9kZWxzL2NvbmZpZy91bmlxdWUtY29uZmlnXCI7XHJcbmltcG9ydCB7IEFubm90YXRpb25UeXBlcyB9IGZyb20gXCIuLi9jb3JlL3ZhbGlkYXRvci5zdGF0aWNcIjtcclxuaW1wb3J0IHsgRm9ybVByb3ZpZGVyIH0gZnJvbSAnLi4vdXRpbC9mb3JtLXByb3ZpZGVyJztcclxuaW1wb3J0IHsgQXBwbGljYXRpb25VdGlsIH0gZnJvbSAnLi4vdXRpbC9hcHAtdXRpbCc7XHJcbmltcG9ydCB7Z2V0Q29uZmlnT2JqZWN0fSBmcm9tIFwiLi4vdXRpbC9jb25maWctcHJvdmlkZXJcIjtcclxuZXhwb3J0IGZ1bmN0aW9uIHVuaXF1ZVZhbGlkYXRvcihjb25maWdNb2RlbDogVW5pcXVlQ29uZmlnKTogVmFsaWRhdG9yRm4ge1xyXG4gICAgdmFyIHNldFRpbWVvdXRGdW5jID0gKGludmFsaWRhdGVDb250cm9sczogQWJzdHJhY3RDb250cm9sW10sIGNvbnRyb2xWYWx1ZXM6IGFueVtdKSA9PiB7XHJcbiAgICBsZXQgdGltZU91dCA9IHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICBpbnZhbGlkYXRlQ29udHJvbHMuZm9yRWFjaCh0ID0+IHtcclxuICAgICAgICBsZXQgaXNNYXRjaGVkID0gY29udHJvbFZhbHVlcy5maWx0ZXIoeCA9PiB4ID09IHQudmFsdWUpWzBdXHJcbiAgICAgICAgaWYgKCFpc01hdGNoZWQpXHJcbiAgICAgICAgICB0LnVwZGF0ZVZhbHVlQW5kVmFsaWRpdHkoKTtcclxuICAgICAgfSlcclxuICAgICAgY2xlYXJUaW1lb3V0KHRpbWVPdXQpO1xyXG4gICAgfSwgMjAwKVxyXG4gIH1cclxuICB2YXIgYWRkaXRpb25hbFZhbGlkYXRpb24gPSAoY29uZmlnOiBVbmlxdWVDb25maWcsIGZpZWxkTmFtZTogc3RyaW5nLCBmb3JtR3JvdXA6IEFic3RyYWN0Q29udHJvbCwgZm9ybUFycmF5OiBGb3JtQXJyYXksIGN1cnJlbnRWYWx1ZTogYW55KSA9PiB7XHJcbiAgICBsZXQgaW5kZXhPZiA9IGZvcm1BcnJheS5jb250cm9scy5pbmRleE9mKGZvcm1Hcm91cCk7XHJcbiAgICBsZXQgZm9ybUFycmF5VmFsdWUgPSBbXTtcclxuICAgIGlmIChpbmRleE9mICE9IC0xKSB7XHJcbiAgICAgIGZvcm1BcnJheS52YWx1ZS5mb3JFYWNoKCh0LCBpKSA9PiB7XHJcbiAgICAgICAgaWYgKGluZGV4T2YgIT0gaSlcclxuICAgICAgICAgIGZvcm1BcnJheVZhbHVlLnB1c2godClcclxuICAgICAgfSlcclxuICAgICAgcmV0dXJuIGNvbmZpZy5hZGRpdGlvbmFsVmFsaWRhdGlvbihjdXJyZW50VmFsdWUsIGluZGV4T2YsIGZpZWxkTmFtZSwgZm9ybUdyb3VwLnZhbHVlLCBmb3JtQXJyYXlWYWx1ZSk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gZmFsc2U7XHJcblxyXG4gIH1cclxuICByZXR1cm4gKGNvbnRyb2w6IEFic3RyYWN0Q29udHJvbCk6IHsgW2tleTogc3RyaW5nXTogYW55IH0gPT4ge1xyXG4gICAgbGV0IGNvbmZpZyA9IGdldENvbmZpZ09iamVjdChjb25maWdNb2RlbCxjb250cm9sKTtcclxuICAgIGlmIChGb3JtUHJvdmlkZXIuUHJvY2Vzc1J1bGUoY29udHJvbCwgY29uZmlnKSkge1xyXG4gICAgICBpZiAoUmVnZXhWYWxpZGF0b3IuaXNOb3RCbGFuayhjb250cm9sLnZhbHVlKSkge1xyXG4gICAgICAgIGxldCBmb3JtQXJyYXkgPSBBcHBsaWNhdGlvblV0aWwuZ2V0UGFyZW50Rm9ybUFycmF5KGNvbnRyb2wpO1xyXG4gICAgICAgIGxldCBwYXJlbnRGb3JtR3JvdXAgPSBjb250cm9sLnBhcmVudCA/IGNvbnRyb2wucGFyZW50IDogdW5kZWZpbmVkO1xyXG4gICAgICAgIGxldCBpbnZhbGlkYXRlQ29udHJvbHM6IEFic3RyYWN0Q29udHJvbFtdID0gW107XHJcbiAgICAgICAgbGV0IGNvbnRyb2xWYWx1ZXMgPSBbXTtcclxuICAgICAgICBpZiAoZm9ybUFycmF5ICYmIHBhcmVudEZvcm1Hcm91cCkge1xyXG4gICAgICAgICAgbGV0IGN1cnJlbnRWYWx1ZSA9IGNvbnRyb2wudmFsdWU7XHJcbiAgICAgICAgICBsZXQgZmllbGROYW1lID0gQXBwbGljYXRpb25VdGlsLmdldEZvcm1Db250cm9sTmFtZShjb250cm9sKTtcclxuICAgICAgICAgIGxldCBpc01hdGNoZWQgPSBmYWxzZTtcclxuICAgICAgICAgIGZvciAobGV0IGZvcm1Hcm91cCBvZiBmb3JtQXJyYXkuY29udHJvbHMpIHtcclxuICAgICAgICAgICAgaWYgKGZvcm1Hcm91cCAhPSBwYXJlbnRGb3JtR3JvdXApIHtcclxuICAgICAgICAgICAgICBpc01hdGNoZWQgPSAoQXBwbGljYXRpb25VdGlsLnRvTG93ZXIoZm9ybUdyb3VwLmNvbnRyb2xzW2ZpZWxkTmFtZV0udmFsdWUpID09IEFwcGxpY2F0aW9uVXRpbC50b0xvd2VyKGN1cnJlbnRWYWx1ZSkgJiYgIShmb3JtR3JvdXAuY29udHJvbHNbZmllbGROYW1lXS5lcnJvcnMgJiYgZm9ybUdyb3VwLmNvbnRyb2xzW2ZpZWxkTmFtZV0uZXJyb3JzW0Fubm90YXRpb25UeXBlcy51bmlxdWVdKSlcclxuICAgICAgICAgICAgICBpZiAoZm9ybUdyb3VwLmNvbnRyb2xzW2ZpZWxkTmFtZV0uZXJyb3JzICYmIGZvcm1Hcm91cC5jb250cm9sc1tmaWVsZE5hbWVdLmVycm9yc1tBbm5vdGF0aW9uVHlwZXMudW5pcXVlXSkge1xyXG4gICAgICAgICAgICAgICAgdmFyIG1hdGNoZWRDb250cm9sID0gZm9ybUFycmF5LmNvbnRyb2xzLmZpbHRlcih0ID0+IHQuY29udHJvbHNbZmllbGROYW1lXSAhPSBmb3JtR3JvdXAuY29udHJvbHNbZmllbGROYW1lXSAmJiBBcHBsaWNhdGlvblV0aWwudG9Mb3dlcih0LmNvbnRyb2xzW2ZpZWxkTmFtZV0udmFsdWUpID09IEFwcGxpY2F0aW9uVXRpbC50b0xvd2VyKGZvcm1Hcm91cC5jb250cm9sc1tmaWVsZE5hbWVdLnZhbHVlKSlbMF07XHJcbiAgICAgICAgICAgICAgICBpZiAoIW1hdGNoZWRDb250cm9sKVxyXG4gICAgICAgICAgICAgICAgICBpbnZhbGlkYXRlQ29udHJvbHMucHVzaChmb3JtR3JvdXAuY29udHJvbHNbZmllbGROYW1lXSlcclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgY29udHJvbFZhbHVlcy5wdXNoKGZvcm1Hcm91cC5jb250cm9sc1tmaWVsZE5hbWVdLnZhbHVlKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoaXNNYXRjaGVkKVxyXG4gICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgaWYgKGludmFsaWRhdGVDb250cm9scy5sZW5ndGggPiAwKVxyXG4gICAgICAgICAgICBzZXRUaW1lb3V0RnVuYyhpbnZhbGlkYXRlQ29udHJvbHMsIGNvbnRyb2xWYWx1ZXMpO1xyXG5cclxuICAgICAgICAgIGxldCB2YWxpZGF0aW9uID0gZmFsc2U7XHJcbiAgICAgICAgICBpZiAoY29uZmlnLmFkZGl0aW9uYWxWYWxpZGF0aW9uKSB7XHJcbiAgICAgICAgICAgIHZhbGlkYXRpb24gPSBhZGRpdGlvbmFsVmFsaWRhdGlvbihjb25maWcsIGZpZWxkTmFtZSwgcGFyZW50Rm9ybUdyb3VwLCBmb3JtQXJyYXksIGN1cnJlbnRWYWx1ZSk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICBpZiAoaXNNYXRjaGVkICYmICF2YWxpZGF0aW9uKVxyXG4gICAgICAgICAgICByZXR1cm4gT2JqZWN0TWFrZXIudG9Kc29uKEFubm90YXRpb25UeXBlcy51bmlxdWUsIGNvbmZpZywgW2NvbnRyb2wudmFsdWVdKVxyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgcmV0dXJuIE9iamVjdE1ha2VyLm51bGwoKTtcclxuICB9XHJcbn1cclxuIl19